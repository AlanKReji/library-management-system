{% extends 'home.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mt-4">    
    <h1>Edit User: {{ editUser.username }}</h1>
</div>
{% if success %}
    <div class="alert alert-success">
        User "{{ editUser.username }}" updated successfully!
    </div>
{% endif %}

<form action="{% url 'editUser' editUser.id %}" method="post">
    {% csrf_token %}

    {# Editable fields: first_name, last_name, username, email #}
    <div class="form-group">
        <label for="first_name">First Name:</label>
        <input type="text" class="form-control" id="first_name" name="first_name" value="{{ editUser.first_name|default:'' }}">
    </div>

    <div class="form-group">
        <label for="last_name">Last Name:</label>
        <input type="text" class="form-control" id="last_name" name="last_name" value="{{ editUser.last_name|default:'' }}">
    </div>

    <div class="form-group">
        <label for="username">Username:</label>
        <input type="text" class="form-control" id="username" name="username" value="{{ editUser.username }}" required>
    </div>
    
    <div class="form-group">
        <label for="email">Email:</label>
        <input type="email" class="form-control" id="email" name="email" value="{{ editUser.email }}" required>
    </div>
    
    {# --- Role Field (Admin Only) --- #}
    {% if isAdmin %}
        <hr>
        <h4>Admin-Only Settings</h4>
        
        {% if can_admin_edit_role %}
            <div class="form-group">
                <label for="role">Role:</label>
                <select class="form-control" id="role" name="role" required>
                    {% for role_value, role_label in role_choices %}
                        <option value="{{ role_value }}" {% if editUser.role == role_value %}selected{% endif %}>
                            {{ role_label }}
                        </option>
                    {% endfor %}
                </select>
                <small class="form-text text-muted">
                    You can only assign **Librarian** or **User** roles. Status flags are set automatically.
                </small>
            </div>
        {% else %}
            <div class="alert alert-warning">
                You cannot change the role of this user (current role: **{{ editUser.get_role_display }}**).
                {# This hidden input is crucial to ensure the POST request doesn't fail due to a missing field expected by the server. #}
                <input type="hidden" name="role" value="{{ editUser.role }}"> 
            </div>
        {% endif %}
    {% endif %}

    <button type="submit" class="btn btn-primary mt-3">Update User</button>
</form>
{% endblock %}